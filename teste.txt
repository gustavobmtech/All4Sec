import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { TranslationService } from './translation.service';
import emailjs from '@emailjs/browser';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './app.component.html',
})
export class AppComponent {
  private translationService = inject(TranslationService);
  t = this.translationService.t;
  
  languages = [
    { code: 'PT', flagUrl: 'https://flagcdn.com/w40/br.png', name: 'Português' },
    { code: 'EN', flagUrl: 'https://flagcdn.com/w40/us.png', name: 'English' },
    { code: 'ES', flagUrl: 'https://flagcdn.com/w40/es.png', name: 'Español' }
  ];
  currentLang = this.languages[0]; 
  isLangMenuOpen = false;
  
  formData = {
    name: '',
    company: '',
    email: '',
    phone: '',
    interest: ''
  };
  isModalOpen = false;

  toggleLangMenu() { this.isLangMenuOpen = !this.isLangMenuOpen; }
  setLanguage(lang: any) { this.currentLang = lang; this.isLangMenuOpen = false; this.translationService.setLanguage(lang.code); }
  openModal(interest: string) { this.formData.interest = interest; this.isModalOpen = true; }
  closeModal() { this.isModalOpen = false; }
  scrollToSolutions() { document.getElementById('solutions')?.scrollIntoView({ behavior: 'smooth' }); }


-----
  async submitForm() {
    // Validação simples
    if (!this.formData.name || !this.formData.email || !this.formData.phone) {
      alert('Por favor, preencha os campos obrigatórios.');
      return;
    }

    const serviceID = 'SEU_SERVICE_ID';   // Ex: service_x9s8f
    const templateID = 'SEU_TEMPLATE_ID'; // Ex: template_8d7s6
    const publicKey = 'SUA_PUBLIC_KEY';   // Ex: user_9s8d7f9s8d7

    const templateParams = {
      to_name: 'Aparicio',
      from_name: this.formData.name,
      company: this.formData.company,
      phone: this.formData.phone,
      reply_to: this.formData.email,
      product: this.formData.interest,
      language: this.currentLang.name,
      message: `Solicitação de cotação para ${this.formData.interest} (${this.currentLang.code})`
    };

    try {
      await emailjs.send(serviceID, templateID, templateParams, publicKey);
      
      alert('Solicitação enviada com sucesso! Entraremos em contato em breve.');
      this.closeModal();
      this.formData = { name: '', company: '', email: '', phone: '', interest: '' }; // Limpa form
      
    } catch (error) {
      console.error('Erro ao enviar:', error);
      
      alert('Houve um erro no envio automático. Abriremos seu e-mail para envio manual.');
      
      const targetEmail = 'aparicio@all4sec.com';
      const subject = `Cotação: ${this.formData.interest}`;
      const body = `Nome: ${this.formData.name}\nEmail: ${this.formData.email}\nTel: ${this.formData.phone}\nInteresse: ${this.formData.interest}`;
      window.location.href = `mailto:${targetEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
  }
}